# Nutrition Lens 要件定義書

## 1. 文書情報

- 文書名: Nutrition Lens 要件定義書
- バージョン: 1.0.0
- 作成日: 2025-12-27
- 作成者: Patrician Philamer Ilada Andres
- 対象アプリ: Nutrition Lens（iOS）

---

## 2. プロジェクト概要

### 2.1 背景

日本国内ではコンビニやスーパーなどで手軽に食品を購入できる一方で、栄養成分やアレルゲン情報への意識も高まっている。  
しかし、パッケージの栄養表示ラベルは小さく見づらく、食品ごとの比較や日々の摂取状況の把握がしにくいという課題がある。

本プロジェクトでは、**バーコードスキャンおよび手入力を通じて、Open Food Facts API から食品情報を取得し、日本語で分かりやすく表示する iOS アプリ「Nutrition Lens」** を開発する。

### 2.2 目的

- ユーザーが食品のバーコードを読み取るだけで、栄養成分や基本情報を素早く確認できるようにする。
- 日本語 UI で、栄養成分（エネルギー・たんぱく質・脂質・炭水化物など）を直感的に理解できるようにする。
- 上流工程（要件定義〜設計）・実装・テスト・CI/CD までを一貫して行ったポートフォリオ用の実例とする。

### 2.3 スコープ

#### 2.3.1 スコープ内

- iOS アプリ「Nutrition Lens」の新規開発
- 対象 OS: iOS 17 以上
- 対象デバイス: iPhone（iPad 最適化は任意）
- 日本語 UI をメインとした表示
- Open Food Facts API を利用した食品情報の取得
- バーコードの手入力による検索
- バーコードスキャン（カメラ）による検索
- 栄養成分（100g あたり）の基本表示
- シンプルなお気に入り登録（ローカル保存）
- 基本的なエラーハンドリング（商品未登録・通信エラーなど）
- CI（自動ビルド＋ユニットテスト実行）

#### 2.3.2 スコープ外（将来検討）

- 食事単位・1日単位の栄養集計・グラフ表示
- 目標摂取量との比較
- アカウント機能・クラウド同期
- 他 API（FatSecret 等）との連携
- アレルゲンの詳細な判定ロジック（法律準拠レベル）
- Android 版アプリ
- Fitbit などウェアラブルデバイスとの連携

---

## 3. 利用者とユースケース

### 3.1 想定ユーザー

- 健康意識が高く、日々の栄養バランスを気にしている一般ユーザー
- コンビニやスーパーで食品を購入する機会が多い人
- ダイエットや筋トレのために、エネルギー・たんぱく質量などを確認したい人
- 日本語 UI で情報を確認したいユーザー

### 3.2 ユースケース概要

#### UC-01: バーコード手入力による食品検索

1. ユーザーはアプリを起動する。
2. 検索画面でバーコード数字を手入力する。
3. 「検索」ボタンを押下する。
4. アプリは Open Food Facts API にリクエストを送信する。
5. 結果が存在する場合、商品名・ブランド名・栄養成分を表示する。
6. 結果が存在しない場合、エラーメッセージを表示する。

#### UC-02: バーコードスキャンによる食品検索

1. ユーザーは「バーコードをスキャン」ボタンを押下する。
2. カメラ画面が表示される。
3. ユーザーは食品のバーコードにカメラをかざす。
4. アプリはバーコードを自動認識し、値を取得する。
5. 取得したバーコードを用いて API に問い合わせを行い、結果を表示する。

#### UC-03: お気に入り登録・一覧表示（MVP）

1. 商品詳細画面で「お気に入りに追加」ボタンを押下する。
2. アプリはローカルストレージに商品情報を保存する。
3. お気に入り一覧画面で保存済みの商品を表示する。

---

## 4. 機能要件

### 4.1 画面一覧

- F-01: バーコード検索画面（手入力 + スキャンボタン）
- F-02: 検索結果（商品詳細）画面
- F-03: お気に入り一覧画面（MVP 範囲）
- F-04: エラー・未登録商品のメッセージ表示（ダイアログまたは画面上メッセージ）

### 4.2 機能詳細

#### F-01: バーコード検索（手入力）

- ユーザーはテキストフィールドにバーコード数字を入力できる。
- 「検索」ボタン押下で API リクエストを実行する。
- 入力が空の場合は検索を実行しない。

#### F-02: バーコードスキャン

- カメラを起動し、EAN / UPC 形式のバーコードを読み取る。
- バーコード認識に成功した場合、自動的に検索処理を実行する。
- カメラ利用には iOS のプライバシー許可を要求する。

#### F-03: 商品詳細表示

- 以下の項目を表示すること（可能な範囲）:
  - 商品名（product_name）
  - ブランド名（brands）
  - エネルギー（kcal / 100g）
  - たんぱく質（g / 100g）
  - 脂質（g / 100g）
  - 炭水化物（g / 100g）
- 値が取得できない場合は「不明」と表示する。

#### F-04: お気に入り管理（MVP）

- 商品詳細画面からお気に入り登録/解除ができる。
- お気に入り一覧画面で登録済み商品を表示できる。
- 保存先はローカル（UserDefaults またはローカルファイル／DB）。

---

## 5. 非機能要件

### 5.1 パフォーマンス

- 通信環境が良好な場合、検索実行から結果表示まで 3 秒以内を目標とする。
- 一度取得した商品情報は簡易キャッシュして再表示を高速化してもよい。

### 5.2 信頼性

- API エラー・タイムアウト時はユーザーに分かりやすいエラーメッセージを表示する。
- アプリクラッシュを避けるため、オプショナル値・パース失敗時のハンドリングを徹底する。

### 5.3 保守性・拡張性

- アーキテクチャは MVVM + Repository パターンを採用する。
- ネットワーク層・データモデル・UI を明確に分離する。
- 依存関係はプロトコルベースで注入できるようにしてテスト容易性を確保する。

### 5.4 セキュリティ・プライバシー

- 本バージョンではユーザーアカウントや個人情報の永続化は行わない。
- 通信は HTTPS を利用する。
- カメラアクセスは iOS のプライバシー設定に従い、用途を明示する。

### 5.5 ローカライズ

- UI 文言は日本語をデフォルトとする。
- `Localizable.strings` による文言管理を行う。
- 英語対応は将来対応としつつ、設計上は拡張可能な形とする。

---

## 6. 外部インターフェース要件

### 6.1 使用 API

- Open Food Facts API  
  - エンドポイント例:  
    - `GET https://world.openfoodfacts.org/api/v0/product/{barcode}.json`
  - 認証: 不要
  - レスポンス形式: JSON

### 6.2 iOS プラットフォーム API

- カメラアクセス: `AVFoundation` を利用したバーコード読み取り
- ネットワークアクセス: `URLSession`
- 永続化: `UserDefaults` または `FileManager`（MVP では簡易でよい）

---

## 7. リスクと制約

### 7.1 リスク

- Open Food Facts に存在しないバーコードの場合、商品情報が取得できない。
- 一部の日本国内商品はデータが不足している可能性がある。
- API 仕様変更の影響を受ける可能性がある。

### 7.2 制約

- オフライン環境では新規検索は実行できない（キャッシュ済みデータのみ表示可能とする場合は別途検討）。
- iOS 17 以上の端末に限定する。

---

## 8. 成果物

- 要件定義書（本書）
- 基本設計書（画面設計・アーキテクチャ設計）
- 詳細設計書（クラス設計・API I/F 定義）
- iOS アプリ実装（Swift / SwiftUI）
- テストコード（ユニットテスト）
- CI 設定（GitHub Actions 等）
- README（日本語/英語）
